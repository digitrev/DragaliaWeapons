CREATE PROCEDURE [den].[spInitializeCht]
AS
BEGIN
	SET NOCOUNT ON

	DECLARE @Json NVARCHAR(MAX)

	TRUNCATE TABLE [den].[Chests]

	SET @Json = 
		'[{"Frequency":"Daily","ChestGroups":[{"ChestGroup":"Elemental Ruins","Quantity":1,"Chests":[{"Quest":"Flamehowl Ruins","Drops":[{"Material":"Flame Orb","Quantity":18},{"Material":"Blaze Orb","Quantity":9},{"Material":"Inferno Orb","Quantity":6}]},{"Quest":"Waterscour Ruins","Drops":[{"Material":"Water Orb","Quantity":18},{"Material":"Stream Orb","Quantity":9},{"Material":"Deluge Orb","Quantity":6}]},{"Quest":"Windmaul Ruins","Drops":[{"Material":"Wind Orb","Quantity":18},{"Material":"Storm Orb","Quantity":9},{"Material":"Maelstrom Orb","Quantity":6}]},{"Quest":"Lightsunder Ruins","Drops":[{"Material":"Light Orb","Quantity":18},{"Material":"Radiance Orb","Quantity":9},{"Material":"Refulgence Orb","Quantity":6}]},{"Quest":"Shadowsteep Ruins","Drops":[{"Material":"Shadow Orb","Quantity":18},{"Material":"Nightfall Orb","Quantity":9},{"Material":"Nether Orb","Quantity":6}]}]},{"ChestGroup":"Dragon Trials","Quantity":1,"Chests":[{"Quest":"Midgardsormr''s Trial","Drops":[{"Material":"Windwyrm''s Scale","Quantity":10},{"Material":"Windwyrm''s Squallscale","Quantity":10}]},{"Quest":"Mercury''s Trial","Drops":[{"Material":"Waterwyrm''s Scale","Quantity":10},{"Material":"Waterwyrm''s Glistscale","Quantity":10}]},{"Quest":"Brunhilda''s Trial","Drops":[{"Material":"Flamewyrm''s Scale","Quantity":10},{"Material":"Flamewyrm''s Scaldscale","Quantity":10}]},{"Quest":"Jupiter''s Trial","Drops":[{"Material":"Lightwyrm''s Scale","Quantity":10},{"Material":"Lightwyrm''s Glowscale","Quantity":10}]},{"Quest":"Zodiark''s Trial","Drops":[{"Material":"Shadowwyrm''s Scale","Quantity":10},{"Material":"Shadowwyrm''s Darkscale","Quantity":10}]}]},{"ChestGroup":"The Imperial Onslaught","Quantity":1,"Chests":[{"Quest":"Battle at Mount Adolla","Drops":[{"Material":"Vermilion Insignia","Quantity":1440},{"Material":"Royal Vermilion Insignia","Quantity":960}]},{"Quest":"Battle at Myriage Lake","Drops":[{"Material":"Azure Insignia","Quantity":1440},{"Material":"Royal Azure Insignia","Quantity":960}]},{"Quest":"Battle in Rovetelle Forest","Drops":[{"Material":"Jade Insignia","Quantity":1440},{"Material":"Royal Jade Insignia","Quantity":960}]},{"Quest":"Battle in the Dornith Mountains","Drops":[{"Material":"Amber Insignia","Quantity":1440},{"Material":"Royal Amber Insignia","Quantity":960}]},{"Quest":"Battle at the Wartarch Ruins","Drops":[{"Material":"Violet Insignia","Quantity":1440},{"Material":"Royal Violet Insignia","Quantity":960}]}]}]},{"Frequency":"Weekly","ChestGroups":[{"ChestGroup":"Advanced Dragon Trials","Quantity":5,"Chests":[{"Quest":"High Midgardsormr''s Trial: Master","Drops":[{"Material":"Windwyrm''s Greatsphere","Quantity":60},{"Material":"High Windwyrm''s Horn","Quantity":24}]},{"Quest":"High Midgardsormr''s Trial: Expert","Drops":[{"Material":"Windwyrm''s Greatsphere","Quantity":39},{"Material":"High Windwyrm''s Tail","Quantity":18},{"Material":"High Windwyrm''s Horn","Quantity":9}]},{"Quest":"High Midgardsormr''s Trial: Standard","Drops":[{"Material":"Windwyrm''s Greatsphere","Quantity":33}]},{"Quest":"High Mercury''s Trial: Master","Drops":[{"Material":"Waterwyrm''s Greatsphere","Quantity":60},{"Material":"High Waterwyrm''s Horn","Quantity":24}]},{"Quest":"High Mercury''s Trial: Expert","Drops":[{"Material":"Waterwyrm''s Greatsphere","Quantity":39},{"Material":"High Waterwyrm''s Tail","Quantity":18},{"Material":"High Waterwyrm''s Horn","Quantity":9}]},{"Quest":"High Mercury''s Trial: Standard","Drops":[{"Material":"Waterwyrm''s Greatsphere","Quantity":33}]},{"Quest":"High Brunhilda''s Trial: Master","Drops":[{"Material":"Flamewyrm''s Greatsphere","Quantity":60},{"Material":"High Flamewyrm''s Horn","Quantity":24}]},{"Quest":"High Brunhilda''s Trial: Expert","Drops":[{"Material":"Flamewyrm''s Greatsphere","Quantity":39},{"Material":"High Flamewyrm''s Tail","Quantity":18},{"Material":"High Flamewyrm''s Horn","Quantity":9}]},{"Quest":"High Brunhilda''s Trial: Standard","Drops":[{"Material":"Flamewyrm''s Greatsphere","Quantity":33}]},{"Quest":"High Jupiter''s Trial: Master","Drops":[{"Material":"Lightwyrm''s Greatsphere","Quantity":60},{"Material":"High Lightwyrm''s Horn","Quantity":24}]},{"Quest":"High Jupiter''s Trial: Expert","Drops":[{"Material":"Lightwyrm''s Greatsphere","Quantity":39},{"Material":"High Lightwyrm''s Tail","Quantity":18},{"Material":"High Lightwyrm''s Horn","Quantity":9}]},{"Quest":"High Jupiter''s Trial: Standard","Drops":[{"Material":"Lightwyrm''s Greatsphere","Quantity":33}]},{"Quest":"High Zodiark''s Trial: Master","Drops":[{"Material":"Shadowwyrm''s Greatsphere","Quantity":60},{"Material":"High Shadowwyrm''s Horn","Quantity":24}]},{"Quest":"High Zodiark''s Trial: Expert","Drops":[{"Material":"Shadowwyrm''s Greatsphere","Quantity":39},{"Material":"High Shadowwyrm''s Tail","Quantity":18},{"Material":"High Shadowwyrm''s Horn","Quantity":9}]},{"Quest":"High Zodiark''s Trial: Standard","Drops":[{"Material":"Shadowwyrm''s Greatsphere","Quantity":33}]}]},{"ChestGroup":"The Agito Uprising","Quantity":5,"Chests":[{"Quest":"Volk''s Wrath: Master","Drops":[{"Material":"Rebellious One''s Insanity","Quantity":18}]},{"Quest":"Volk''s Wrath: Expert","Drops":[{"Material":"Destitute One''s Mask Fragment","Quantity":12},{"Material":"Plagued One''s Mask Fragment","Quantity":18},{"Material":"Rebellious One''s Insanity","Quantity":6}]},{"Quest":"Volk''s Wrath: Standard","Drops":[{"Material":"Destitute One''s Mask Fragment","Quantity":27},{"Material":"Plagued One''s Mask Fragment","Quantity":3}]},{"Quest":"Ciella''s Wrath: Master","Drops":[{"Material":"Rebellious One''s Desperation","Quantity":18}]},{"Quest":"Ciella''s Wrath: Expert","Drops":[{"Material":"Eliminating One''s Mask Fragment","Quantity":12},{"Material":"Despairing One''s Mask Fragment","Quantity":18},{"Material":"Rebellious One''s Desperation","Quantity":6}]},{"Quest":"Ciella''s Wrath: Standard","Drops":[{"Material":"Eliminating One''s Mask Fragment","Quantity":27},{"Material":"Despairing One''s Mask Fragment","Quantity":3}]},{"Quest":"Ayaha & Otoha''s Wrath: Master","Drops":[{"Material":"Rebellious One''s Cruelty","Quantity":18}]},{"Quest":"Ayaha & Otoha''s Wrath: Expert","Drops":[{"Material":"Soaring Ones'' Mask Fragment","Quantity":12},{"Material":"Liberated One''s Mask Fragment","Quantity":18},{"Material":"Rebellious One''s Cruelty","Quantity":6}]},{"Quest":"Ayaha & Otoha''s Wrath: Standard","Drops":[{"Material":"Soaring Ones'' Mask Fragment","Quantity":27},{"Material":"Liberated One''s Mask Fragment","Quantity":3}]},{"Quest":"Kai Yan''s Wrath: Master","Drops":[{"Material":"Rebellious One''s Arrogance","Quantity":18}]},{"Quest":"Kai Yan''s Wrath: Expert","Drops":[{"Material":"Almighty One''s Mask Fragment","Quantity":12},{"Material":"Uprooting One''s Mask Fragment","Quantity":18},{"Material":"Rebellious One''s Arrogance","Quantity":6}]},{"Quest":"Kai Yan''s Wrath: Standard","Drops":[{"Material":"Almighty One''s Mask Fragment","Quantity":27},{"Material":"Uprooting One''s Mask Fragment","Quantity":3}]},{"Quest":"Tartarus''s Wrath: Master","Drops":[{"Material":"Rebellious One''s Loyalty","Quantity":18}]},{"Quest":"Tartarus''s Wrath: Expert","Drops":[{"Material":"Remaining One''s Mask Fragment","Quantity":12},{"Material":"Vengeful One''s Mask Fragment","Quantity":18},{"Material":"Rebellious One''s Loyalty","Quantity":6}]},{"Quest":"Tartarus''s Wrath: Standard","Drops":[{"Material":"Remaining One''s Mask Fragment","Quantity":27},{"Material":"Vengeful One''s Mask Fragment","Quantity":3}]}]},{"ChestGroup":"Rise of the Sinister Dominion","Quantity":3,"Chests":[{"Quest":"Jaldabaoth''s Piercing Gale: Master","Drops":[{"Material":"Cyclone Shard","Quantity":7},{"Material":"Cyclone Prism","Quantity":10}]},{"Quest":"Jaldabaoth''s Piercing Gale: Expert","Drops":[{"Material":"Cyclone Shard","Quantity":4},{"Material":"Cyclone Prism","Quantity":6}]},{"Quest":"Jaldabaoth''s Piercing Gale: Standard","Drops":[{"Material":"Cyclone Shard","Quantity":9},{"Material":"Cyclone Prism","Quantity":1}]},{"Quest":"Iblis''s Surging Cascade: Master","Drops":[{"Material":"Whirlpool Shard","Quantity":7},{"Material":"Whirlpool Prism","Quantity":10}]},{"Quest":"Iblis''s Surging Cascade: Expert","Drops":[{"Material":"Whirlpool Shard","Quantity":4},{"Material":"Whirlpool Prism","Quantity":6}]},{"Quest":"Iblis''s Surging Cascade: Standard","Drops":[{"Material":"Whirlpool Shard","Quantity":9},{"Material":"Whirlpool Prism","Quantity":1}]},{"Quest":"Surtr''s Devouring Flame: Master","Drops":[{"Material":"Firestorm Shard","Quantity":7},{"Material":"Firestorm Prism","Quantity":10}]},{"Quest":"Surtr''s Devouring Flame: Expert","Drops":[{"Material":"Firestorm Shard","Quantity":4},{"Material":"Firestorm Prism","Quantity":6}]},{"Quest":"Surtr''s Devouring Flame: Standard","Drops":[{"Material":"Firestorm Shard","Quantity":9},{"Material":"Firestorm Prism","Quantity":1}]},{"Quest":"Asura''s Blinding Light: Master","Drops":[{"Material":"Blinding Shard","Quantity":7},{"Material":"Blinding Prism","Quantity":10}]},{"Quest":"Asura''s Blinding Light: Expert","Drops":[{"Material":"Blinding Shard","Quantity":4},{"Material":"Blinding Prism","Quantity":6}]},{"Quest":"Asura''s Blinding Light: Standard","Drops":[{"Material":"Blinding Shard","Quantity":9},{"Material":"Blinding Prism","Quantity":1}]},{"Quest":"Lilith''s Encroaching Shadow: Master","Drops":[{"Material":"Twilight Shard","Quantity":7},{"Material":"Twilight Prism","Quantity":10}]},{"Quest":"Lilith''s Encroaching Shadow: Expert","Drops":[{"Material":"Twilight Shard","Quantity":4},{"Material":"Twilight Prism","Quantity":6}]},{"Quest":"Lilith''s Encroaching Shadow: Standard","Drops":[{"Material":"Twilight Shard","Quantity":9},{"Material":"Twilight Prism","Quantity":1}]}]},{"ChestGroup":"Primal Dragon Trials","Quantity":3,"Chests":[{"Quest":"Primal Midgardsormr''s Trial: Master","Drops":[{"Material":"Primal Windwyrm''s Emerald","Quantity":6}]},{"Quest":"Primal Midgardsormr''s Trial: Expert","Drops":[{"Material":"Primal Windwyrm''s Emerald","Quantity":2},{"Material":"Primal Windwyrm''s Greatsphere","Quantity":6},{"Material":"Primal Windwyrm''s Sphere","Quantity":4}]},{"Quest":"Primal Midgardsormr''s Trial: Standard","Drops":[{"Material":"Primal Windwyrm''s Greatsphere","Quantity":1},{"Material":"Primal Windwyrm''s Sphere","Quantity":9}]}]},{"ChestGroup":"The Agito Uprising: Legend Difficulty","Quantity":1,"Chests":[{"Quest":"Volk''s Wrath: Legend Difficulty","Drops":[{"Material":"Rebellious Wolf''s Gale","Quantity":10}]},{"Quest":"Ciella''s Wrath: Legend Difficulty","Drops":[{"Material":"Rebellious Bird''s Tide","Quantity":10}]},{"Quest":"Ayaha & Otoha''s Wrath: Legend Difficulty","Drops":[{"Material":"Rebellious Butterflies'' Searing Fire","Quantity":10}]},{"Quest":"Kai Yan''s Wrath: Legend Difficulty","Drops":[{"Material":"Rebellious Ox''s Lightning","Quantity":10}]},{"Quest":"Tartarus''s Wrath: Legend Difficulty","Drops":[{"Material":"Rebellious Lion''s Twilight","Quantity":10}]}]}]}]'

	INSERT [den].[Chests] (
		Frequency
		,ChestGroup
		,QuestQuantity
		,Quest
		,Material
		,DropQuantity
		)
	SELECT f.Frequency
		,cg.ChestGroup
		,cg.Quantity
		,c.Quest
		,d.Material
		,d.Quantity
	FROM OPENJSON(@Json) WITH (
			Frequency NVARCHAR(50)
			,ChestGroups NVARCHAR(MAX) AS JSON
			) AS f
	CROSS APPLY OPENJSON(f.ChestGroups) WITH (
			ChestGroup NVARCHAR(50)
			,Quantity INT
			,Chests NVARCHAR(MAX) AS JSON
			) AS cg
	CROSS APPLY OPENJSON(cg.Chests) WITH (
			Quest NVARCHAR(50)
			,Drops NVARCHAR(MAX) AS JSON
			) AS c
	CROSS APPLY OPENJSON(c.Drops) WITH (
			Material NVARCHAR(50)
			,Quantity INT
			) AS d
END
